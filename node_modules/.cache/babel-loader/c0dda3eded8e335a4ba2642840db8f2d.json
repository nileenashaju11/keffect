{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport { Controller } from \"stimulus\";\nimport { Sortable } from '@shopify/draggable';\n\nvar _default = /*#__PURE__*/function (_Controller) {\n  _inherits(_default, _Controller);\n\n  var _super = _createSuper(_default);\n\n  function _default() {\n    _classCallCheck(this, _default);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(_default, [{\n    key: \"connect\",\n    value: function connect() {\n      var _this = this;\n\n      var draggable = new Sortable(this.actionsTarget, {\n        mirror: {\n          appendTo: '.draggable-target',\n          constrainDimensions: true\n        }\n      });\n      draggable.on('drag:stop', function (e) {\n        var source = e.data.source;\n        var actionId = source.getAttribute('data-action-id');\n        var children = Array.prototype.slice.call(_this.actionsTarget.children);\n        var filteredChildren = children.filter(function (child) {\n          return child.classList.length == 1 || child.classList.contains('draggable-source--is-dragging');\n        });\n        var index = filteredChildren.indexOf(source); // update order of actionId to 1 plus the index\n\n        fetch(\"/actions/\".concat(actionId, \"/reorder\"), {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRF-Token': _this.getMetaValue('csrf-token')\n          },\n          body: JSON.stringify({\n            order: index + 1\n          })\n        }).then(function () {\n          return window.location.reload();\n        });\n      });\n    }\n  }, {\n    key: \"getMetaValue\",\n    value: function getMetaValue(name) {\n      var element = document.head.querySelector(\"meta[name=\\\"\".concat(name, \"\\\"]\"));\n      return element.getAttribute(\"content\");\n    }\n  }]);\n\n  return _default;\n}(Controller);\n\n_default.targets = ['actions', 'item'];\nexport { _default as default };","map":{"version":3,"sources":["/home/techversant/aptana_studio_projet/keffect_lead_nurturer-master/app/javascript/controllers/draggable_controller.js"],"names":["Controller","Sortable","draggable","actionsTarget","mirror","appendTo","constrainDimensions","on","e","source","data","actionId","getAttribute","children","Array","prototype","slice","call","filteredChildren","filter","child","classList","length","contains","index","indexOf","fetch","method","headers","getMetaValue","body","JSON","stringify","order","then","window","location","reload","name","element","document","head","querySelector","targets"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,SAASA,UAAT,QAA2B,UAA3B;AACA,SAASC,QAAT,QAAyB,oBAAzB;;;;;;;;;;;;;;;WAKE,mBAAU;AAAA;;AACR,UAAIC,SAAS,GAAG,IAAID,QAAJ,CAAa,KAAKE,aAAlB,EAAiC;AAC/CC,QAAAA,MAAM,EAAE;AACNC,UAAAA,QAAQ,EAAE,mBADJ;AAENC,UAAAA,mBAAmB,EAAE;AAFf;AADuC,OAAjC,CAAhB;AAMAJ,MAAAA,SAAS,CAACK,EAAV,CAAa,WAAb,EAA0B,UAACC,CAAD,EAAO;AAC/B,YAAIC,MAAM,GAAGD,CAAC,CAACE,IAAF,CAAOD,MAApB;AACA,YAAIE,QAAQ,GAAGF,MAAM,CAACG,YAAP,CAAoB,gBAApB,CAAf;AACA,YAAIC,QAAQ,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2B,KAAI,CAACd,aAAL,CAAmBU,QAA9C,CAAf;AACA,YAAIK,gBAAgB,GAAGL,QAAQ,CAACM,MAAT,CAAgB,UAAAC,KAAK;AAAA,iBAAIA,KAAK,CAACC,SAAN,CAAgBC,MAAhB,IAA0B,CAA1B,IAA+BF,KAAK,CAACC,SAAN,CAAgBE,QAAhB,CAAyB,+BAAzB,CAAnC;AAAA,SAArB,CAAvB;AACA,YAAIC,KAAK,GAAGN,gBAAgB,CAACO,OAAjB,CAAyBhB,MAAzB,CAAZ,CAL+B,CAM/B;;AACAiB,QAAAA,KAAK,oBAAaf,QAAb,eAAiC;AACpCgB,UAAAA,MAAM,EAAE,KAD4B;AAEpCC,UAAAA,OAAO,EAAE;AACP,4BAAgB,kBADT;AAEP,4BAAgB,KAAI,CAACC,YAAL,CAAkB,YAAlB;AAFT,WAF2B;AAMpCC,UAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAAEC,YAAAA,KAAK,EAAGT,KAAK,GAAG;AAAlB,WAAf;AAN8B,SAAjC,CAAL,CAOGU,IAPH,CAOQ;AAAA,iBAAMC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,EAAN;AAAA,SAPR;AAQD,OAfD;AAgBD;;;WAED,sBAAaC,IAAb,EAAmB;AACjB,UAAMC,OAAO,GAAGC,QAAQ,CAACC,IAAT,CAAcC,aAAd,uBAA0CJ,IAA1C,SAAhB;AACA,aAAOC,OAAO,CAAC3B,YAAR,CAAqB,SAArB,CAAP;AACD;;;;EA/B0BZ,U;;SACpB2C,O,GAAU,CAAE,SAAF,EAAa,MAAb,C","sourcesContent":["import { Controller } from \"stimulus\"\nimport { Sortable } from '@shopify/draggable'\n\nexport default class extends Controller {\n  static targets = [ 'actions', 'item' ]\n\n  connect() {\n    let draggable = new Sortable(this.actionsTarget, {\n      mirror: {\n        appendTo: '.draggable-target',\n        constrainDimensions: true,\n      },\n    })\n    draggable.on('drag:stop', (e) => {\n      let source = e.data.source\n      let actionId = source.getAttribute('data-action-id')\n      let children = Array.prototype.slice.call(this.actionsTarget.children)\n      let filteredChildren = children.filter(child => child.classList.length == 1 || child.classList.contains('draggable-source--is-dragging'))\n      let index = filteredChildren.indexOf(source)\n      // update order of actionId to 1 plus the index\n      fetch(`/actions/${actionId}/reorder`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRF-Token': this.getMetaValue('csrf-token')\n        },\n        body: JSON.stringify({ order: (index + 1) })\n      }).then(() => window.location.reload())\n    })\n  }\n\n  getMetaValue(name) {\n    const element = document.head.querySelector(`meta[name=\"${name}\"]`)\n    return element.getAttribute(\"content\")\n  }\n}\n"]},"metadata":{},"sourceType":"module"}